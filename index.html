<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlushMaster</title>
<link rel="icon" type="image/png" href="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

<style>
body{
  overflow-y: auto;   /* permite rolagem vertical */
  overflow-x: hidden; /* bloqueia rolagem lateral */
}

/* estado padr√£o: fora da tela */
.tela{
    position: fixed;
    inset: 0;
    background: #3dc8ff;

    transform: translateX(100%);
    transition: none;

    pointer-events: none;
}

/* tela vis√≠vel */
.tela.base{
    transform: translateX(0);
    pointer-events: auto;
    z-index: 2;
}

/* habilita anima√ß√£o */
.tela.animando{
    transition: transform .4s ease;
}

/* tela saindo */
.tela.saindo{
    transform: translateX(-100%);
    z-index: 1;
}


/* GERAL */
.logo{width:240px;margin:25px auto;display:block}
.card{
    background:#f7e9dd;
    width:90%;
    max-width:380px;
    margin:20px auto;
    padding:25px;
    border-radius:20px;
    text-align:center;
}
.btn{
    width:100%;
    padding:14px;
    margin-top:15px;
    border:none;
    border-radius:12px;
    background:linear-gradient(#4db8ff,#0077e6);
    color:#fff;
    font-size:18px;
    cursor:pointer;

    /* üî• CORRE√á√ÉO DO LOADER */
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:52px; /* altura real com padding */
}



input{
    width:90%;
    padding:12px;
    border-radius:10px;
    border:2px solid #000;
    margin:10px 0;
}
footer{text-align:center;margin-top:15px}

#telaHome{
    background: linear-gradient(#4fc3ff,#dff5ff);
    display:flex;
    flex-direction:column;
}
.top-bar{
    height:70px;
    background:#4fc3ff;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:20px;
    font-weight:bold;
}
.camera-box {
    background: black;
    margin: 10px auto;       /* centraliza */
    border-radius: 2px;      /* quase quadrado */
    width: 100%;
    max-width: 600px;
    aspect-ratio: 16/9;
    overflow: hidden;
}
.camera-box iframe {
    width: 100%;
    height: 100%;
    border: none;
}


.play-area{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
}
.play-btn{
    width:180px;
    height:180px;
    border-radius:50%;
    background: radial-gradient(circle at top, #7be5ff, #009dff);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:30px;
    font-weight:bold;
    color:white;
    text-decoration:none;
    box-shadow:0 10px 20px rgba(0,0,0,0.3);
    cursor:pointer;
    transition:0.2s;
}
.play-btn:active{
    transform:scale(0.95);
}
.bottom-bar{
    height:90px;
    background:#4fc3ff;
    border-top-left-radius:25px;
    border-top-right-radius:25px;
    display:flex;
    justify-content:space-around;
    align-items:center;
    box-shadow:0 -3px 10px rgba(0,0,0,0.2);
}
.nav-item{
    text-align:center;
    font-size:12px;
    color:#1a6fa3;
}
.nav-circle{
    width:50px;
    height:50px;
    margin:0 auto 5px;
    border-radius:50%;
    background:linear-gradient(#aaf0ff,#4fc3ff);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    color:white;
}
.play-btn{
    width:180px;
    height:180px;
    border-radius:50%;
    background: radial-gradient(circle at top, #7be5ff, #009dff);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:30px;
    font-weight:bold;
    color:white;
    text-decoration:none;
    box-shadow:0 10px 20px rgba(0,0,0,0.3);
    cursor:pointer;
    transition:0.2s;
}

.btn-chat {
    position: fixed;      /* fica sempre fixo na tela */
    top: 10px;            /* dist√¢ncia do topo */
    right: 10px;          /* dist√¢ncia da borda direita */
    background: linear-gradient(#24c6ff, #009ef7);
    color: white;
    padding: 12px 20px;
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000;       /* sempre acima de tudo */
    transition: transform 0.2s;
}

.btn-chat:hover {
    transform: scale(1.05);
}
/* ================= CHAT ================= */
#telaChat{
  background:#f3f3f3;
  display:flex;
  flex-direction:column;
}

#telaChat .topo{
  background:#4fc3ff;
  padding:15px 15px 25px 15px;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
}

#telaChat .voltar{
  font-size:22px;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

#telaChat .logo{
  font-weight:bold;
  font-size:20px;
  color:white;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
}

#telaChat .perfil{
  width:42px;
  height:42px;
  background:white;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#4fc3ff;
  font-size:20px;
}

/* chat messages */
#chat-messages{
  flex:1;
  padding:15px;
  overflow-y:auto;
}

#chat-messages .message{
  max-width:70%;
  margin-bottom:10px;
  padding:10px 15px;
  border-radius:15px;
  word-wrap:break-word;
}

#chat-messages .sent{
  background:#24c6ff;
  color:#fff;
  margin-left:auto;
  text-align:right;
}

#chat-messages .received{
  background:#fff;
  color:#000;
  margin-right:auto;
}

/* input */
#telaChat .chat-input-container{
  display:flex;
  padding:10px 15px;
  gap:10px;
  background:#4fc3ff;
}

#chat-input{
  flex:1;
  padding:10px 15px;
  border-radius:50px;
  border:none;
  font-size:16px;
  background:#e0f7ff;
  color:#000;
}

#send-btn{
  padding:10px 20px;
  border:none;
  border-radius:50px;
  background: linear-gradient(#24c6ff,#009ef7);
  color:white;
  cursor:pointer;
  font-size:16px;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family: Arial, sans-serif;
}



body{
  background: linear-gradient(#43c6ff, #e9f7ff);
  min-height:100vh;
}


/* TOPO */
.topo{
    display:flex;
    align-items:center;
    gap:10px;
    padding:15px;
}

.voltar{
    width:35px;
    height:35px;
    background:#a7e7ff;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    cursor:pointer;
}

.logo{
    font-weight:bold;
    color:#fff;
    font-size:20px;
}

/* =========================
   TELA SELECIONAR (ISOLADO)
========================= */

#telaSelecionar{
    background:#fff5eb;
}

/* TOPO */
.sel-topo{
    background:#4fc3ff;
    height:80px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
}

.sel-voltar{
    position:absolute;
    left:15px;
    width:36px;
    height:36px;
    border-radius:50%;
    background:rgba(255,255,255,0.3);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    cursor:pointer;
}

.sel-logo{
    font-size:22px;
    font-weight:bold;
    color:#fff;
}

/* BLOCO */
.sel-jogadas{
  margin:15px 20px;
  background:#fff;
  border-radius:18px;
  padding:10px 14px;

  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* TEXTO */
.sel-jogadas-texto{
  font-size:15px;
  font-weight:bold;
  color:#4fc3ff;
}

/* DROPDOWN FECHADO */
.sel-dropdown{
  background:#f3eadf;
  padding:8px 12px;
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
  min-width:70px;
  justify-content:space-between;
}

/* LISTA */
.sel-lista{
  position:absolute;
  right:35px;
  margin-top:5px;

  background:#fff;
  border-radius:8px;
  box-shadow:0 8px 20px rgba(0,0,0,0.15);

  max-height:150px; /* mostra ~5 */
  overflow-y:auto;

  display:none;
  z-index:1000;
}

/* ITEM */
.sel-lista div{
  padding:10px;
  text-align:center;
  cursor:pointer;
}

.sel-lista div:hover{
  background:#4fc3ff;
  color:#fff;
}



/* T√çTULO */
.sel-titulo{
    padding:0 20px;
    font-size:22px;
    font-weight:bold;
    color:#333;
}

/* M√ÅQUINAS */
.sel-maquinas{
    display:flex;
    gap:15px;
    padding:20px;
}

.sel-card{
    flex:1;
    background:#ffffff;
    border-radius:20px;
    padding:15px;
    text-align:center;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

.sel-card img{
    width:100%;
    border-radius:15px;
}

/* PRE√áO */
.sel-preco{
    font-size:18px;
    font-weight:bold;
    margin:10px 0;
}

/* BOT√ÉO STATUS */
.sel-btn-status{
    width:100%;
    height:36px;
    border:none;
    border-radius:20px;
    font-weight:bold;
    font-size:14px;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* STATUS */
.sel-disponivel{
    background:#4fc3ff;
    color:#fff;
}

.sel-selecionada{
    background:#bdbdbd;
    color:#fff;
}

.sel-indisponivel{
    background:#9e9e9e;
    color:#fff;
    cursor:not-allowed;
}

/* SALDO */
.sel-saldo{
    background:#ffffff;
    margin:20px;
    padding:15px;
    border-radius:20px;
    font-size:18px;
    font-weight:bold;
}

/* BOT√ÉO FINAL */
.sel-btn-iniciar{
    margin:20px;
    background:linear-gradient(#00c6ff,#0072ff);
    color:#fff;
    text-align:center;
    padding:18px;
    border-radius:30px;
    font-size:22px;
    font-weight:bold;
    cursor:pointer;
}
/* CARD DA M√ÅQUINA */
.sel-card{
  background:#fff;
  border-radius:20px;
  padding:15px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:space-between;
}

/* CONTAINER DA IMAGEM */
.sel-card img{
  width:100%;
  height:160px;          /* ALTURA PADR√ÉO PARA TODAS */
  object-fit:contain;   /* N√ÉO DISTORCE */
  display:block;
}



.notificacao{
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #000;                 /* FUNDO PRETO */
  color: #fff;                      /* TEXTO BRANCO */
  padding: 14px 22px;
  border-radius: 8px;

  border: 2px solid #ff2b2b;        /* BORDA VERMELHA */
  box-shadow: 
    0 0 10px #ff2b2b,
    0 0 25px rgba(255,43,43,0.6);

  font-family: Orbitron, sans-serif;
  font-size: 14px;
  font-weight: bold;
  text-align: center;

  z-index: 999999;
  opacity: 0;
  pointer-events: none;
  transition: opacity .4s, top .4s;
}

.notificacao.ativa{
  opacity: 1;
  top: 40px;
}



    @keyframes aparecer {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }
.loader {
  border: 4px solid #f3f3f3;        /* cor de fundo da bolinha */
  border-top: 4px solid #00d6ff;    /* cor do spinner */
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;

  /* centraliza dentro do container */
  margin: 40px auto; 
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.maquinas .card {
    display: none;  /* esconde todos os cards at√© o Firebase carregar */
}
/* INTRO */
#intro {
  position: fixed;
  inset: 0;
  background: white;
  z-index: 9999;

  display: flex;
  align-items: center;
  justify-content: center;
}


/* BOLINHA AZUL */
.ball {
  width: 40px;
  height: 40px;
  background: #00c3ff;
  border-radius: 50%;
  animation: jumpGrow 1.6s ease-in-out forwards;
}

/* LOGO DA INTRO */
.intro-logo {
  position: absolute;
  width: 220px;
  opacity: 0;
  animation: logoFade 0.5s ease forwards;
  animation-delay: 1.6s;
}


/* PULO BAIXO + CRESCIMENTO */
@keyframes jumpGrow {
  0% {
    transform: translateY(0) scale(1);
  }
  20% {
    transform: translateY(-12px) scale(1);
  }
  40% {
    transform: translateY(0) scale(1);
  }
  100% {
    transform: scale(50);
  }
}

/* APARECER LOGO */
@keyframes logoFade {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
/* ================= TELA CARTEIRA ================= */


#telaCarteira{
  background:#f3f3f3;
  overflow-y:auto;
  min-height:100vh;
}

/* TOPO */
.carteira-topo{
  background:#4fc3ff;
  padding:15px 15px 25px;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
}

.carteira-linha{
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.carteira-voltar{
  font-size:22px;
  color:#fff;
  cursor:pointer;
}

.carteira-logo{
  font-size:20px;
  font-weight:bold;
  color:#fff;
}

.carteira-perfil{
  width:42px;
  height:42px;
  background:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#4fc3ff;
}

/* TITULOS */
.carteira-titulo{
  margin-top:15px;
  font-size:26px;
  font-weight:bold;
  color:#05326b;
}

.carteira-sub{
  font-size:16px;
  color:#05326b;
}

/* CONTE√öDO */
.carteira-sessao{
  padding:20px;
}

.saldo-titulo{
  font-size:22px;
  font-weight:bold;
  margin-bottom:15px;
}

.saldo-box{
  background:#59cfff;
  border-radius:20px;
  padding:25px 10px;
  text-align:center;
  color:#fff;
}

.saldo-valor{
  font-size:38px;
  font-weight:bold;
}

.pelucias{
  margin-top:8px;
  font-size:15px;
  opacity:.9;
}

/* RECARGA */
.recarga{
  padding:0 20px 20px;
}

.recarga h3{
  font-size:20px;
  margin-bottom:10px;
}

.valor-box{
  font-size:30px;
  font-weight:bold;
}

.cupom{
  margin-top:6px;
  font-size:14px;
  text-decoration:underline;
  cursor:pointer;
}

/* BOT√ÉO */
.carteira-btn{
  margin:20px;
  width:calc(100% - 40px);
  padding:18px;
  font-size:18px;
  border:none;
  border-radius:50px;
  background:linear-gradient(#24c6ff,#009ef7);
  color:#fff;
  cursor:pointer;
}

/* ===== TELA CONTA ===== */
#telaConta{
    background:#fff5eb;
}

/* TOPO */
#telaConta .topo{
    background:#4fc3ff;
    height:120px;
    border-bottom-left-radius:25px;
    border-bottom-right-radius:25px;
    padding:20px;
    display:flex;
    align-items:center;
    position:relative;
}

#telaConta .botao-voltar{
    width:45px;
    height:45px;
    background:rgba(255,255,255,0.3);
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:22px;
    color:#fff;
    cursor:pointer;
}

#telaConta .logo{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    color:white;
    font-size:22px;
    font-weight:bold;
}

/* INFO */
#telaConta .info-area{
    background:#4fc3ff;
    padding:20px;
    padding-bottom:40px;
    border-bottom-left-radius:25px;
    border-bottom-right-radius:25px;
    margin-top:-10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

#telaConta .titulo{
    font-size:26px;
    font-weight:bold;
    color:#003c7a;
}

#telaConta .subtitulo{
    font-size:18px;
    margin-top:5px;
    color:#003c7a;
}

/* AVATAR */
#telaConta .avatar{
    width:55px;
    height:55px;
    background:white;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:22px;
    font-weight:bold;
    color:#003c7a;
}

/* CARDS */
#telaConta .cards{
    margin:20px;
}

#telaConta .card{
    background:white;
    border-radius:20px;
    padding:20px;
    margin-bottom:20px;
    box-shadow:0 2px 4px rgba(0,0,0,0.15);
    cursor:pointer;
}

#telaConta .card h3{
    font-size:22px;
    color:#35b6ff;
    font-weight:bold;
}

/* SAIR */
#telaConta .sair{
    margin:50px 20px;
    font-size:18px;
    color:#444;
    display:flex;
    align-items:center;
    gap:10px;
    cursor:pointer;
}
/* ===== TELA MINHAS INFORMA√á√ïES ===== */
#telaInformacoes{
    background:#fdf1e3;
    min-height:100vh;
}

/* TOPO */
#telaInformacoes .topo{
    background:#4fc3ff;
    padding:15px;
    display:flex;
    align-items:center;
    position:relative;
}

#telaInformacoes .voltar{
    font-size:26px;
    color:#fff;
    cursor:pointer;
    font-weight:bold;
}

#telaInformacoes .logo{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    color:white;
    font-size:20px;
    font-weight:bold;
}

/* T√çTULO */
#telaInformacoes .titulo{
    font-size:24px;
    font-weight:bold;
    color:#4fc3ff;
    margin:20px;
}

/* CAIXA DE DADOS */
#telaInformacoes .box{
    background:#fff4e8;
    margin:0 20px;
    padding:20px;
    border-radius:15px;
}

#telaInformacoes .box p{
    font-size:18px;
    margin-bottom:15px;
}

#telaInformacoes .label{
    font-weight:bold;
    color:#444;
}

#telaInformacoes .valor{
    color:#000;
}

/* LINKS */
#telaInformacoes .link{
    margin:20px;
    font-size:18px;
    color:#2e5bd3;
    cursor:pointer;
}

#telaInformacoes .link:hover{
    text-decoration:underline;
}

/* EXCLUIR */
#telaInformacoes .excluir{
    margin:40px 20px;
    font-size:18px;
    color:#b30000;
    cursor:pointer;
}

#telaInformacoes .excluir:hover{
    text-decoration:underline;
}

/* ===== POPUP ALTERAR NOME ===== */
#telaInformacoes .popup-bg{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:1000;
}

#telaInformacoes .popup-box{
    background:#fff;
    padding:20px;
    width:80%;
    max-width:350px;
    border-radius:15px;
    text-align:center;
}

#telaInformacoes .popup-box h3{
    margin-bottom:10px;
    font-size:20px;
    color:#4fc3ff;
}

#telaInformacoes .popup-input{
    width:100%;
    padding:10px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #ccc;
    margin-bottom:15px;
}

#telaInformacoes .popup-btn{
    background:#4fc3ff;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
}

#telaInformacoes .popup-btn:active{
    transform:scale(0.95);
}

#telaInformacoes .cancelar{
    margin-top:10px;
    font-size:15px;
    color:#999;
    cursor:pointer;
}

#telaInformacoes .cancelar:hover{
    text-decoration:underline;
}

/* ===== POPUP EXCLUIR CONTA ===== */
#telaInformacoes .popup-fundo{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.7);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:1000;
}

#telaInformacoes .popup-caixa{
    background:#ffffff;
    width:85%;
    max-width:350px;
    padding:20px;
    border-radius:15px;
    text-align:center;
    animation: popupAparecer 0.2s ease-out;
}

@keyframes popupAparecer{
    from{ transform:scale(0.85); opacity:0; }
    to{ transform:scale(1); opacity:1; }
}

#telaInformacoes .popup-titulo{
    font-size:22px;
    font-weight:bold;
    margin-bottom:10px;
}

#telaInformacoes .popup-texto{
    font-size:15px;
    margin-bottom:15px;
}

#telaInformacoes .popup-botoes{
    display:flex;
    justify-content:space-between;
    gap:10px;
}

#telaInformacoes .btn-cancelar{
    flex:1;
    background:#ccc;
    border:none;
    padding:10px;
    border-radius:10px;
    font-size:16px;
}

#telaInformacoes .btn-confirmar{
    flex:1;
    background:#ff4d4d;
    color:white;
    border:none;
    padding:10px;
    border-radius:10px;
    font-size:16px;
    font-weight:bold;
}
.btn{
  position: relative;
  width: 100%;
  padding: 14px;
  margin-top: 15px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(#4db8ff,#0077e6);
  color: #fff;
  font-size: 18px;
  cursor: pointer;

  display: flex;
  align-items: center;
  justify-content: center;
}

/* texto do bot√£o */
.btn .btn-text{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: opacity .2s;
}

/* loader */
.btn .btn-loader{
  position: absolute;
  width: 22px;
  height: 22px;
  border: 3px solid rgba(255,255,255,.3);
  border-top: 3px solid #fff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  opacity: 0;
}

/* estado carregando */
.btn.loading .btn-text{
  opacity: 0;
}

.btn.loading .btn-loader{
  opacity: 1;
}

@keyframes spin{
  to{ transform: rotate(360deg); }
}

.esqueceu-senha{
  margin-top: 10px;
  font-size: 14px;
  color: #1e90ff; /* azul */
  cursor: pointer;
  text-align: center;
}

.esqueceu-senha:hover{
  text-decoration: underline;
}



</style>
</head>
<body>
<div id="notificacoes"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
if (!firebase.apps.length) {
  firebase.initializeApp({
    apiKey: "AIzaSyApQ9KvXtv4_negpU9wHlajGeOuZ1FSKBA",
    authDomain: "plush-master.firebaseapp.com",
    projectId: "plush-master"
  });
}

const auth = firebase.auth();
const db = firebase.firestore();
</script>
<!-- INTRO -->
<div id="intro">
  <div class="ball"></div>
  <img class="intro-logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const logo  = document.querySelector(".intro-logo");
  const intro = document.getElementById("intro");
  const tela1 = document.getElementById("tela1");

  if (!logo || !intro || !tela1) return;

  // quando a anima√ß√£o da LOGO terminar
  logo.addEventListener("animationend", () => {

    // espera 2 segundos com a tela parada
    setTimeout(() => {

      // remove a intro
      intro.remove();

      // ativa a Tela 1
      tela1.classList.add("base");
      tela1.style.pointerEvents = "auto";

    }, 2000); // ‚è± 2 segundos

  }, { once: true });
  
});

</script>
<!-- TELA 1 -->
<section id="tela1" class="tela base">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <button class="btn" onclick="irPara('telacadastro/Login')">Vamos come√ßar</button>
    </div>
    <footer>¬© 2026 PlushMaster</footer>
</section>



<!-- LOGIN EMAIL -->
<section id="telacadastro/Login" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <h2>Entre ou Cadastre-se</h2>
        <input id="emailLogin" type="email" placeholder="email@email.com">
        <button id="btnContinuar" class="btn" onclick="irParaUsuario(this)">
  <span class="btn-text">Continuar</span>
  <span class="btn-loader"></span>
</button>
        
    </div>
</section>

<!-- SENHA -->
<section id="telaSenha" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <h2>Senha</h2>
        <p id="emailExibido"></p>
        <input id="senha" type="password" placeholder="Senha">
        <div class="esqueceu-senha" onclick="redefinirSenha()">
  Esqueceu sua senha?
</div>
        <button id="btnEntrar" class="btn" onclick="entrar()">
  <span class="btn-text">Entrar</span>
  <span class="btn-loader"></span>
</button>

       </button>
        <button class="btn" onclick="voltarPara('telacadastro/Login')">Voltar</button>
    </div>
</section>



<!-- TELA USU√ÅRIO -->
<section id="telaCadastroUsuario" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

    <div class="card">
        <h2>Crie Um Nome de Usu√°rio Para Sua conta</h2>

        <input
          type="text"
          id="usernameCadastro"
          placeholder="Crie um nome de usu√°rio"
        >

        <button class="btn" onclick="irParaSenha(this)">
  <span class="btn-text">Continuar</span>
  <span class="btn-loader"></span>
</button>



        <button class="btn" onclick="voltarPara('telaCadastroEmail')">Voltar</button>
    </div>
</section>


<!-- TELA SENHA -->
<section id="telaCadastroSenha" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

    <div class="card">
        <h2>Crie uma senha para acessar seu conta</h2>

        <input
          type="password"
          id="senha1"
          placeholder="Digite a senha"
        >

        <input
          type="password"
          id="senha2"
          placeholder="Digite novamente"
        >

        <button class="btn" onclick="finalizarCadastro(this)">
      <span class="btn-text">Criar conta</span>
      <span class="btn-loader"></span>
    </button>

        <button class="btn" onclick="voltarPara('telaCadastroUsuario')">Voltar</button>
    </div>
</section>
<section id="telaConta" class="tela">

    <div class="topo">
        <div class="botao-voltar" onclick="irSemAnimacao('telaHome')"><</div>
        <div class="logo">PlushMaster</div>
    </div>

    <div class="info-area">
        <div>
            <div class="titulo">Minha conta</div>
            <div class="subtitulo" id="textoOla">Ol√°, ...</div>
        </div>

        <div class="avatar" id="avatarLetra">U</div>
    </div>

    <div class="cards">
        <div class="card" onclick="irPara('telaHistorico')">
            <h3>üìä Hist√≥rico de atividades</h3>
        </div>

        <div class="card" onclick="irPara('telaInformacoes')">
    <h3>üìò Minhas informa√ß√µes</h3>
</div>

    </div>

    <div class="sair" onclick="sairConta()">
        <span>‚Ü∫</span> Sair da conta
    </div>

</section>
<section id="telaInformacoes" class="tela">

    <!-- TOPO -->
    <div class="topo">
        <div class="voltar" onclick="voltarPara('telaConta')"><</div>
        <div class="logo">PlushMaster</div>
    </div>

    <div class="titulo">Minhas informa√ß√µes</div>

    <div class="box">
        <p><span class="label">Apelido:</span>
            <span class="valor" id="campoNome">Carregando...</span>
        </p>

        <p><span class="label">E-mail:</span>
            <span class="valor" id="campoEmail">Carregando...</span>
        </p>

        <p><span class="label">Senha:</span> ***************</p>
    </div>

    <div class="link" onclick="alterarNome()">Alterar apelido</div>
    <div class="link" onclick="alterarSenha()">Alterar senha</div>
    <div class="excluir" onclick="excluirConta()">Excluir conta</div>

    <!-- POPUP ALTERAR NOME -->
    <div class="popup-bg" id="popupNome">
        <div class="popup-box">
            <h3>Alterar apelido</h3>
            <input type="text" id="novoNome" class="popup-input" placeholder="Digite o novo nome">
            <button class="popup-btn" onclick="salvarNovoNome()">Salvar</button>
            <div class="cancelar" onclick="fecharPopup()">Cancelar</div>
        </div>
    </div>

    <!-- POPUP EXCLUIR CONTA -->
    <div id="popupExcluir" class="popup-fundo" style="display:none;">
        <div class="popup-caixa">
            <div class="popup-titulo">Excluir Conta</div>
            <p class="popup-texto">Digite sua senha para confirmar:</p>

            <input type="password" id="senhaExcluir" class="popup-input" placeholder="Sua senha">

            <div class="popup-botoes">
                <button class="btn-cancelar" onclick="fecharPopupExcluir()">Cancelar</button>
                <button class="btn-confirmar" onclick="confirmarExclusao()">Excluir</button>
            </div>
        </div>
    </div>

</section>





<!-- ================= HOME ================= -->
<section id="telaHome" class="tela">
    <!-- TOPO -->
    <div class="top-bar">
        <div class="btn-chat" onclick="irDeBaixo('telaChat')">üí¨</div>
        <div>PlushMaster</div>
        <div style="width:45px;"></div> <!-- espa√ßo √† direita para equilibrar -->
    </div>

    <!-- C√ÇMERA -->
    <div class="camera-box">
        <iframe src="https://delaysp01.logicahost.com.br:5443/onlinemachine/play.html?id=onlinemachine0"
        allow="autoplay; fullscreen"></iframe>
    </div>

    <!-- BOT√ÉO JOGAR -->
    <div class="play-area">
         <button class="play-btn" onclick="abrirTelaSelecionar('telaselecionar')"style="border:none; outline:none;">JOGAR</button>
    </div>

  
    <!-- MENU INFERIOR -->
    <div class="bottom-bar">
        <div class="nav-item" onclick="irSemAnimacao('telaHome')">
            <div class="nav-circle">üè†</div>
            Home
        </div>
        <div class="nav-item" onclick="irSemAnimacao('telaCarteira')">
            <div class="nav-circle">üí∞</div>
            Carteira
        </div>
        <div class="nav-item" onclick="irSemAnimacao('telaConta')">
            <div class="nav-circle">üë§</div>
            Conta
        </div>
        <div class="nav-item" onclick="irSemAnimacao('telaPelucias')">
            <div class="nav-circle">üß∏</div>
            Pel√∫cias
        </div>
    </div>
</section>
<!-- ================= CARTEIRA ================= -->
<section id="telaCarteira" class="tela">

  <div class="carteira-topo">
    <div class="carteira-linha">
      <div class="carteira-voltar" onclick="irSemAnimacao('telaHome')"><</div>
      <div class="carteira-logo">PlushMaster</div>
      <div class="carteira-perfil" id="letraPerfil">U</div>
    </div>

    <div class="carteira-titulo">Carteira</div>
    <div class="carteira-sub" id="nomeUser">Ol√°, ...</div>
  </div>

  <div class="carteira-sessao">
    <div class="saldo-titulo">üí≤ Saldo na carteira</div>

    <div class="saldo-box">
      <div class="saldo-valor" id="saldoCarteira">R$ 0,00</div>
      <div class="pelucias" id="peluciasCarteira">0 pel√∫cias acumuladas</div>
    </div>
  </div>

  <div class="recarga">
    <h3>üí≥ Qual valor voc√™ quer adicionar?</h3>
    <div class="valor-box" id="valorSelecionado">R$ 0,00</div>
    <div class="cupom">Tenho um cupom</div>
  </div>

  <button class="carteira-btn" onclick="pagar()">Prosseguir para o pagamento</button>

</section>



<section id="telaSelecionar" class="tela">

  <div class="sel-topo">
    <div class="sel-voltar" onclick="voltarPara('telaHome')"><</div>
    <div class="sel-logo">PlushMaster</div>
  </div>

<div class="sel-jogadas">
  <div class="sel-jogadas-texto">üòä Selecionar jogadas</div>

  <div class="sel-dropdown" onclick="toggleJogadas()">
    <span id="valorJogadas">00</span>
    <div class="sel-seta">‚ñº</div>
  </div>
</div>

<div class="sel-lista" id="listaJogadas">
  <!-- 1 at√© 30 -->
  <div onclick="selecionarJogada(1)">1</div>
  <div onclick="selecionarJogada(2)">2</div>
  <div onclick="selecionarJogada(3)">3</div>
  <div onclick="selecionarJogada(4)">4</div>
  <div onclick="selecionarJogada(5)">5</div>
  <div onclick="selecionarJogada(6)">6</div>
  <div onclick="selecionarJogada(7)">7</div>
  <div onclick="selecionarJogada(8)">8</div>
  <div onclick="selecionarJogada(9)">9</div>
  <div onclick="selecionarJogada(10)">10</div>
  <!-- ‚Ä¶ at√© 30 -->
</div>


  <div class="sel-titulo">üì± Selecionar m√°quina</div>

  <div id="loader" class="loader"></div>

  <div class="sel-maquinas">

    <div class="sel-card" onclick="clicarMaquina('plush')">
      <img src="https://i.postimg.cc/6345mtXp/maquina-de-2-imagem-removebg-preview.png">
      <div class="sel-preco">R$ 2,00 a jogada</div>
      <button class="sel-btn-status sel-disponivel" id="statusPlush">
        Selecionar
      </button>
    </div>

    <div class="sel-card" onclick="clicarMaquina('toy')">
      <img src="https://i.postimg.cc/59Pn3Jtg/toy-mix-imagem-removebg-preview.png">
      <div class="sel-preco">R$ 5,00 a jogada</div>
      <button class="sel-btn-status sel-disponivel" id="statusToy">
        Selecionar
      </button>
    </div>

  </div>

  <div class="sel-saldo">
  <span id="saldoUsuario">R$ 0,00</span>
</div>


  <div class="sel-btn-iniciar" onclick="iniciarJogo()">
    Entrar na fila
  </div>

</section>


<script>
let jogadas = 0;
let maquinaSelecionada = null;
let statusMaquinas = { plush: "disponivel", toy: "disponivel" };

function clicarMaquina(id) {
  // se estiver indispon√≠vel, bloqueia
  if (statusMaquinas[id] !== "disponivel") {
    notificar("Essa m√°quina n√£o est√° dispon√≠vel no momento!");
    return;
  }

  // üîÅ TOGGLE: se clicar na j√° selecionada, desseleciona
  if (maquinaSelecionada === id) {
    maquinaSelecionada = null;

    ["plush","toy"].forEach(m => {
      const btn = document.getElementById(
        "status" + m.charAt(0).toUpperCase() + m.slice(1)
      );
      if (!btn) return;

      if (statusMaquinas[m] === "disponivel") {
        btn.innerText = "Selecionar";
        btn.className = "sel-btn-status sel-disponivel";
      } else {
        btn.innerText = "Indispon√≠vel";
        btn.className = "sel-btn-status sel-indisponivel";
      }
    });

    return;
  }

  // sele√ß√£o normal
  maquinaSelecionada = id;

  ["plush","toy"].forEach(m => {
    const btn = document.getElementById(
      "status" + m.charAt(0).toUpperCase() + m.slice(1)
    );
    if (!btn) return;

    if (statusMaquinas[m] !== "disponivel") {
      btn.innerText = "Indispon√≠vel";
      btn.className = "sel-btn-status sel-indisponivel";
      return;
    }

    if (m === id) {
      btn.innerText = "Selecionada";
      btn.className = "sel-btn-status sel-selecionada";
    } else {
      btn.innerText = "Selecionar";
      btn.className = "sel-btn-status sel-disponivel";
    }
  });
}


function iniciarJogo() {
  if (!maquinaSelecionada) return notificar("Selecione uma m√°quina!");
  if (jogadas <= 0) return notificar("Selecione o n√∫mero de jogadas!");

  if (statusMaquinas[maquinaSelecionada] !== "disponivel")
    return notificar("A m√°quina selecionada n√£o est√° dispon√≠vel!");

  firebase.auth().onAuthStateChanged(user => {
    if (!user) return;

    const userRef = db.collection("users").doc(user.uid);
    userRef.get().then(doc => {
      if (!doc.exists) return;

      let saldo = doc.data().saldo || 0;
      let valorJogada = maquinaSelecionada === "toy" ? 5 : 2;
      let total = jogadas * valorJogada;

      if (saldo < total)
        return notificar("Saldo insuficiente!");

      saldo -= total;

      userRef.update({ saldo }).then(() => {
        notificar("M√°quina iniciada! Boa sorte üß∏");
        function atualizarSaldoTelaSelecionar(saldo){
  const el = document.getElementById("saldoUsuario");
  if(!el) return;

  el.innerText = "R$ " + saldo.toFixed(2).replace(".", ",");
}

      });
    });
  });
}

/* LISTENER DAS M√ÅQUINAS */
let listenerMaquinas = null;

function abrirTelaSelecionar() {
  irPara("telaSelecionar");

  document.getElementById("loader").style.display = "block";
  document.querySelectorAll(".sel-maquinas .sel-card")
    .forEach(c => c.style.display = "none");

  if (listenerMaquinas) listenerMaquinas();

  listenerMaquinas = db.collection("maquinas").onSnapshot(snapshot => {
    snapshot.forEach(doc => {
      const id = doc.id;
      const status = doc.data().status;
      statusMaquinas[id] = status;

      const btn = document.getElementById(
        id === "plush" ? "statusPlush" : "statusToy"
      );

      const card = btn.closest(".sel-card");

      if (status !== "disponivel") {
        btn.innerText = "Indispon√≠vel";
        btn.className = "sel-btn-status sel-indisponivel";

        card.style.pointerEvents = "none";
        card.style.opacity = "0.5";

        if (maquinaSelecionada === id) {
          maquinaSelecionada = null;
        }
      } else {
        if (maquinaSelecionada !== id) {
          btn.innerText = "Selecionar";
          btn.className = "sel-btn-status sel-disponivel";
        }

        card.style.pointerEvents = "auto";
        card.style.opacity = "1";
      }
    });

    document.getElementById("loader").style.display = "none";
    document.querySelectorAll(".sel-maquinas .sel-card")
      .forEach(c => c.style.display = "block");
  });
}


function toggleJogadas(){
  const lista = document.getElementById("listaJogadas");
  lista.style.display = lista.style.display === "block" ? "none" : "block";
}

function selecionarJogada(valor){
  jogadas = valor;
  document.getElementById("valorJogadas").innerText =
    String(valor).padStart(2, "0");

  document.getElementById("listaJogadas").style.display = "none";
}

/* FECHAR AO CLICAR FORA */
document.addEventListener("click", e => {
  if (!e.target.closest(".sel-dropdown") &&
      !e.target.closest(".sel-lista")) {
    document.getElementById("listaJogadas").style.display = "none";
  }
});

</script>

</script>


<!-- TELA CHAT -->
<section id="telaChat" class="tela">
  <div class="topo">
    <div class="voltar" onclick="fecharParaBaixo('telaHome')"><</div>
    <div class="logo">PlushMaster</div>
    <div class="perfil" id="perfil">U</div>
  </div>

  <div id="chat-messages" style="flex:1; padding:15px; overflow-y:auto;"></div>

  <div class="chat-input-container" style="display:flex; padding:10px; gap:10px; background:#4fc3ff;">
    <input type="text" id="chat-input" placeholder="Digite sua mensagem..." style="flex:1; padding:10px 15px; border-radius:50px; border:none; font-size:16px; background:#e0f7ff; color:#000;">
    <button id="send-btn" style="padding:10px 20px; border:none; border-radius:50px; background: linear-gradient(#24c6ff,#009ef7); color:white; cursor:pointer; font-size:16px;">Enviar</button>
  </div>
</section>

<script>
const perfil = document.getElementById('perfil');
const chatInput = document.getElementById('chat-input');
const chatMessages = document.getElementById('chat-messages');
const sendBtn = document.getElementById('send-btn');


auth.onAuthStateChanged(async (user) => {
  if (!user) {
    // Se n√£o estiver logado, volta para a tela de login
    irPara('telacadastro/Login');
    return;
  }

  // Mostra a inicial do perfil (username)
  const userDoc = await db.collection('users').doc(user.uid).get();
  if (userDoc.exists) {
    const username = userDoc.data().username;
    perfil.innerText = username.charAt(0).toUpperCase();
  }

  sendBtn.onclick = async () => {
    const text = chatInput.value.trim();
    if (!text) return;


  // Busca o nome do usu√°rio no Firestore
  const userDoc = await db.collection('users').doc(user.uid).get();
let nomeUsuario = 'Usu√°rio';

if (userDoc.exists && userDoc.data().username) {
  nomeUsuario = userDoc.data().username;
}

await db.collection('chat').add({
  username: nomeUsuario, // ‚úÖ campo correto
  uid: user.uid,
  message: text,
  timestamp: firebase.firestore.FieldValue.serverTimestamp()
});

chatInput.value = '';
};



  // Receber mensagens em tempo real
db.collection('chat').orderBy('timestamp')
  .onSnapshot(snapshot => {
    chatMessages.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement('div');

      div.classList.add('message');
      div.classList.add(data.uid === user.uid ? 'sent' : 'received');

      const nome = data.user || 'Usu√°rio'; // üëà garante nome
      div.textContent = `${data.username}: ${data.message}`;


      chatMessages.appendChild(div);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
  });
});
</script>

<!-- L√ìGICA -->
<script>
let telaAtual = document.querySelector(".tela.base");
let historicoTelas = [];

function irPara(id){
    const nova = document.getElementById(id);
    if(!nova || nova === telaAtual) return;

    historicoTelas.push(telaAtual.id);

    // nova come√ßa fora da tela (direita)
    nova.style.transition = "none";
    nova.style.transform = "translateX(100%)";
    nova.classList.add("base");

    nova.offsetWidth;

    // anima nova entrando
    nova.style.transition = "transform .35s ease";
    nova.style.transform = "translateX(0)";

    // anima atual s√≥ um pouco para esquerda
    telaAtual.style.transition = "transform .35s ease";
    telaAtual.style.transform = "translateX(-30%)";

    setTimeout(()=>{
        telaAtual.style.transition = "";
        telaAtual.style.transform = "";
        telaAtual.classList.remove("base");

        telaAtual = nova;
    }, 350);
}

function voltarPara(){
    if(historicoTelas.length === 0) return;

    const idAnterior = historicoTelas.pop();
    const anterior = document.getElementById(idAnterior);
    if(!anterior) return;

    // tela anterior estava recuada ‚Üí come√ßa em -30%
    anterior.style.transition = "none";
    anterior.style.transform = "translateX(-30%)";
    anterior.classList.add("base");

    anterior.offsetWidth;

    // anterior volta para o centro
    anterior.style.transition = "transform .35s ease";
    anterior.style.transform = "translateX(0)";

    // tela atual sai para a direita
    telaAtual.style.transition = "transform .35s ease";
    telaAtual.style.transform = "translateX(100%)";

    setTimeout(()=>{
        telaAtual.classList.remove("base");
        telaAtual.style.transition = "";
        telaAtual.style.transform = "";

        telaAtual = anterior;
    }, 350);
}


function irSemAnimacao(id){
    const nova = document.getElementById(id);
    if(!nova || nova === telaAtual) return;

    // remove a tela atual
    telaAtual.classList.remove("base");

    // limpa qualquer res√≠duo de anima√ß√£o
    telaAtual.style.transition = "";
    telaAtual.style.transform = "";
    nova.style.transition = "";
    nova.style.transform = "";

    // mostra a nova tela instantaneamente
    nova.classList.add("base");

    telaAtual = nova;
}
function irDeBaixo(id){
    const nova = document.getElementById(id);
    if(!nova || nova === telaAtual) return;

    // estado inicial
    nova.style.transition = "none";
    nova.style.transform = "translateY(100%)";
    nova.classList.add("base");

    nova.offsetWidth;

    // anima subida
    nova.style.transition = "transform .5s ease";
    nova.style.transform = "translateY(0)";

    setTimeout(()=>{
        nova.style.transition = "";
        telaAtual = nova;
    }, 350);
}

function fecharParaBaixo(idAnterior){
    const atual = telaAtual;
    const anterior = document.getElementById(idAnterior);
    if(!anterior) return;

    // garante que a tela de tr√°s esteja vis√≠vel
    anterior.classList.add("base");

    atual.style.transition = "transform .5s ease";
    atual.style.transform = "translateY(100%)";

    setTimeout(()=>{
        atual.classList.remove("base");
        atual.style.transition = "";
        atual.style.transform = "";

        telaAtual = anterior;
    }, 350);
}





function entrar(){
  // üî• pega o email exibido na tela
  const email = document.getElementById("emailExibido").innerText.trim();
  const senha = document.getElementById("senha").value.trim();

  if(!email || !senha){
    notificar("Digite a senha");
    return;
  }

  setBtnLoading("btnEntrar", true);

  auth.signInWithEmailAndPassword(email, senha)
    .then(() => {
      localStorage.setItem("loginAutomatico", "true");

      setBtnLoading("btnEntrar", false);
      irPara("telaHome");
    })
    .catch((err) => {
      if(err.code === "auth/wrong-password"){
        notificar("Senha incorreta");
      }else{
        notificar("Email ou senha incorreto");
      }

      setBtnLoading("btnEntrar", false);
    });
}


let emailCadastro = "";
let usernameCadastro = "";

function mostrarTela(id){
  document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
  document.getElementById(id).classList.add('ativa');
}

let verificandoEmail = false;

async function irParaUsuario(btn){
  const emailInput = document.getElementById('emailLogin');
  const email = emailInput.value.trim();

  if(!email){
    notificar("Digite um email v√°lido");
    return;
  }

  btn.classList.add("loading");
  verificandoEmail = true;

  try {
    // üî• m√©todo que voc√™ j√° usa
    await auth.createUserWithEmailAndPassword(email, "teste123");

    console.log("EMAIL N√ÉO CADASTRADO");

    // remove usu√°rio de teste
    const user = auth.currentUser;
    await user.delete();
    await auth.signOut(); // üî• limpa sess√£o

    emailCadastro = email;
    irPara('telaCadastroUsuario');

  } catch(err) {

    if(err.code === "auth/email-already-in-use"){
      console.log("EMAIL EM USO");

      emailCadastro = email;
      document.getElementById("emailExibido").innerText = email;
      irPara("telaSenha");

    } else if(err.code === "auth/invalid-email"){
      notificar("Email inv√°lido");
    } else {
      notificar("Erro: " + err.message);
      console.error(err);
    }

  } finally {
    verificandoEmail = false;
    btn.classList.remove("loading");
  }
}


async function irParaSenha(btn){
  const username = document.getElementById('usernameCadastro').value.trim();
  if(!username){
    notificar("Digite o nome de usu√°rio");
    return;
  }

  // üî• ativa loader
  setBtnLoading(btn, true);

  try{
    const snap = await db.collection("users")
      .where("username", "==", username)
      .get();

    if(!snap.empty){
      notificar("Nome de usu√°rio j√° existe");
      setBtnLoading(btn, false); // ‚ùå erro ‚Üí remove loader
      return;
    }

    usernameCadastro = username;

    setBtnLoading(btn, false); // ‚úÖ DESLIGA
    irPara('telaCadastroSenha');

  }catch(err){
    notificar("Erro ao verificar usu√°rio");
    setBtnLoading(btn, false); // ‚ùå erro ‚Üí remove loader
  }
}



async function finalizarCadastro(btn){
  const senha1 = document.getElementById('senha1').value;
  const senha2 = document.getElementById('senha2').value;

  if(!senha1 || !senha2){
    notificar("Digite a senha duas vezes");
    return;
  }

  if(senha1 !== senha2){
    notificar("As senhas n√£o s√£o iguais");
    return;
  }

  // üî• ATIVA LOADER NO BOT√ÉO
  setBtnLoading(btn, true);

  try{
    const cred = await auth.createUserWithEmailAndPassword(emailCadastro, senha1);

    await db.collection("users").doc(cred.user.uid).set({
      email: emailCadastro,
      username: usernameCadastro,
      saldo: 0,
      pelucias: 0,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });

    notificar("Conta criada com sucesso!");

    // ‚úÖ DESLIGA O LOADER ANTES DA TROCA
    setBtnLoading(btn, false);

    // üî• ANIMA√á√ÉO NORMAL
    irPara('telaHome');

  }catch(err){
    notificar(err.message);

    // ‚ùå ERRO ‚Üí REMOVE LOADER
    setBtnLoading(btn, false);
  }
}



function notificar(msg) {
  const container = document.getElementById("notificacoes");
  if (!container) return;

  const div = document.createElement("div");
  div.className = "notificacao"; // üî• CLASSE CERTA
  div.innerText = msg;

  container.appendChild(div);

  // for√ßa o navegador a reconhecer o elemento antes da anima√ß√£o
  requestAnimationFrame(() => {
    div.classList.add("ativa");
  });

  // remove ap√≥s 3 segundos
  setTimeout(() => {
    div.classList.remove("ativa");
    setTimeout(() => div.remove(), 400);
  }, 3000);
}
</script>
<script>



/* ================= VARI√ÅVEIS ================= */
let valorRecarga = 0;

/* ================= SELECIONAR VALOR ================= */
function selecionarValor(valor){
  valorRecarga = valor;

  const el = document.getElementById("valorSelecionado");
  if(el){
    el.innerText = "R$ " + valor.toFixed(2).replace(".", ",");
  }
}

/* ================= PAGAMENTO (SIMULADO) ================= */
function pagar(){
  if(valorRecarga <= 0){
    notificar("Selecione um valor para recarga");
    return;
  }

  notificar("Pagamento em desenvolvimento üí≥");
}

/* ================= ATUALIZA√á√ÉO EM TEMPO REAL ================= */
firebase.auth().onAuthStateChanged((user) => {
  if(!user) return;

  db.collection("users").doc(user.uid)
    .onSnapshot((doc) => {
      if(!doc.exists) return;

      const dados = doc.data();
      const saldo = dados.saldo || 0;
      const pelucias = dados.pelucias || 0;
const nomeUser = document.getElementById("nomeUser");
const letraPerfil = document.getElementById("letraPerfil");

if(nomeUser){
  nomeUser.innerText = "Ol√°, " + (dados.username || "Usu√°rio");
}

if(letraPerfil && dados.username){
  letraPerfil.innerText = dados.username.charAt(0).toUpperCase();
}

      /* ===== TELA SELECIONAR ===== */
      const saldoSel = document.getElementById("saldoUsuario");
      if(saldoSel){
        saldoSel.innerText =
          "Saldo: R$ " + saldo.toFixed(2).replace(".", ",");
      }

      /* ===== TELA CARTEIRA ===== */
      const saldoCart = document.getElementById("saldoCarteira");
      const pelCart   = document.getElementById("peluciasCarteira");

      if(saldoCart){
        saldoCart.innerText =
          "R$ " + saldo.toFixed(2).replace(".", ",");
      }

      if(pelCart){
        pelCart.innerText =
          pelucias + " pel√∫cias acumuladas";
      }
    });
});
</script>
<script>

auth.onAuthStateChanged(async (user) => {

  // üî• ignora enquanto estiver s√≥ verificando email
  if (verificandoEmail) return;

  if (!user) return;

  const textoOla = document.getElementById("textoOla");
  const avatar   = document.getElementById("avatarLetra");

  if (!textoOla || !avatar) return;

  try {
    const snap = await db.collection("users").doc(user.uid).get();

    let username = "Usu√°rio";

    if (snap.exists && snap.data().username) {
      username = snap.data().username;
    }

    textoOla.innerText = "Ol√°, " + username;
    avatar.innerText  = username.charAt(0).toUpperCase();

  } catch (e) {
    console.error("Erro ao carregar nome:", e);
  }
});

</script>

<script>
function sairConta(){
    auth.signOut().then(() => {
        irPara("telacadastro/Login");
    });
}
</script>
<script>
auth.onAuthStateChanged(async user => {
    if (!user) return;

    const emailEl = document.getElementById("campoEmail");
    const nomeEl  = document.getElementById("campoNome");

    if (!emailEl || !nomeEl) return;

    emailEl.innerText = user.email;

    const ref = db.collection("users").doc(user.uid);
    const snap = await ref.get();

    let username = "‚Äî";

    if (snap.exists) {
        const dados = snap.data();
        if (dados.username) {
            username = dados.username;
        }
    }

    nomeEl.innerText = username;
});
</script>

<script>

function fecharPopup(){
    document.getElementById("popupNome").style.display = "none";
}

async function salvarNovoNome(){
    const novo = document.getElementById("novoNome").value.trim();

    if (novo.length < 3) {
        notificar("O nome deve ter pelo menos 3 letras.");
        return;
    }

    const user = auth.currentUser;
    if (!user) return;



    document.getElementById("campoNome").innerText = novo;
    window.jaMudouNome = true;
    fecharPopup();
    notificar("Apelido alterado com sucesso!");
}
</script>
<script>
function alterarSenha(){
    const email = auth.currentUser.email;
    auth.sendPasswordResetEmail(email)
        .then(() => notificar("Link de redefini√ß√£o enviado para " + email))
        .catch(e => notificar(e.message));
}
</script>
<script>
function excluirConta(){
    document.getElementById("popupExcluir").style.display = "flex";
}

function fecharPopupExcluir(){
    document.getElementById("popupExcluir").style.display = "none";
}

async function confirmarExclusao(){
    const senha = document.getElementById("senhaExcluir").value.trim();
    if (!senha) {
        notificar("Digite sua senha.");
        return;
    }

    const user = auth.currentUser;
    if (!user) return;

    try {
        const cred = firebase.auth.EmailAuthProvider.credential(user.email, senha);
        await user.reauthenticateWithCredential(cred);

        await db.collection("users").doc(user.uid).delete();
        await user.delete();

        notificar("Conta exclu√≠da com sucesso.");
        irPara("telacadastro/Login");

    } catch (e) {
        notificar("Erro: " + e.message);
    }
}
</script>
<script>
let podeAlterarUsername = false;

auth.onAuthStateChanged(async user => {
    if (!user) return;

    const ref = db.collection("users").doc(user.uid);
    const snap = await ref.get();

    if (!snap.exists) return;

    const dados = snap.data();

    // Mostra username
    document.getElementById("campoNome").innerText =
        dados.username || "‚Äî";

    // controla se pode alterar
    if (dados.usernameAlterado === true) {
        podeAlterarUsername = false;
    } else {
        podeAlterarUsername = true;
    }
});

function alterarNome(){
    if (!podeAlterarUsername) {
        notificar("Voc√™ s√≥ pode alterar o apelido uma vez.");
        return;
    }
    document.getElementById("popupNome").style.display = "flex";
}

function fecharPopup(){
    document.getElementById("popupNome").style.display = "none";
}

async function salvarNovoNome(){
    const novo = document.getElementById("novoNome").value.trim();

    if (novo.length < 3) {
        notificar("O apelido deve ter pelo menos 3 letras.");
        return;
    }

    const user = auth.currentUser;
    if (!user) return;

    // üîé verifica duplicado
    const consulta = await db
        .collection("users")
        .where("username", "==", novo)
        .get();

    if (!consulta.empty) {
        notificar("Esse apelido j√° est√° em uso.");
        return;
    }

    // ‚úÖ salva definitivamente
    await db.collection("users").doc(user.uid).update({
        username: novo,
        usernameAlterado: true
    });

    document.getElementById("campoNome").innerText = novo;
    podeAlterarUsername = false;

    fecharPopup();
    notificar("Apelido alterado com sucesso!");
}
</script>
<script>
function setBtnLoading(btn, loading){
  // aceita ID ou elemento
  if (typeof btn === "string") {
    btn = document.getElementById(btn);
  }

  if (!btn) return;

  if (loading) {
    btn.classList.add("loading");
    btn.disabled = true;
  } else {
    btn.classList.remove("loading");
    btn.disabled = false;
  }
}
function redefinirSenha(){
  const email = document.getElementById("emailExibido").innerText.trim();

  if(!email){
    notificar("Email n√£o encontrado");
    return;
  }

  auth.sendPasswordResetEmail(email)
    .then(() => {
      notificar(`Enviamos um email de redefini√ß√£o para:\n${email}`);
    })
    .catch(err => {
      if(err.code === "auth/invalid-email"){
        notificar("Email inv√°lido");
      }else if(err.code === "auth/user-not-found"){
        notificar("Usu√°rio n√£o encontrado");
      }else{
        notificar("Erro ao enviar email de redefini√ß√£o");
        console.error(err);
      }
    });
}


</script>
</body>
</html>