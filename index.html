<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlushMaster</title>
<link rel="icon" type="image/png" href="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

<style>
body{
  overflow-y: auto;   /* permite rolagem vertical */
  overflow-x: hidden; /* bloqueia rolagem lateral */
}

/* TELAS */
.tela{
    position:fixed;
    inset:0;
    background:#3dc8ff;
    transform:translateX(100%);
    transition:.4s ease;
    pointer-events:none;
}
.tela{
  overflow-y: auto;                 /* üî• rolagem interna */
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch; /* iOS suave */
}

.tela.base{
    transform:translateX(0);
    pointer-events:auto;
    z-index:1;
}
.tela.entrando{
    transform:translateX(0);
    z-index:2;
}

/* GERAL */
.logo{width:240px;margin:25px auto;display:block}
.card{
    background:#f7e9dd;
    width:90%;
    max-width:380px;
    margin:20px auto;
    padding:25px;
    border-radius:20px;
    text-align:center;
}
.btn{
    width:100%;
    padding:14px;
    margin-top:15px;
    border:none;
    border-radius:12px;
    background:linear-gradient(#4db8ff,#0077e6);
    color:#fff;
    font-size:18px;
    cursor:pointer;
}
input{
    width:90%;
    padding:12px;
    border-radius:10px;
    border:2px solid #000;
    margin:10px 0;
}
footer{text-align:center;margin-top:15px}

#telaHome{
    background: linear-gradient(#4fc3ff,#dff5ff);
    display:flex;
    flex-direction:column;
}
.top-bar{
    height:70px;
    background:#4fc3ff;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:20px;
    font-weight:bold;
}
.camera-box{
    background:black;
    margin:10px;
    border-radius:10px;
    height:230px;
    overflow:hidden;
}
.camera-box iframe{
    width:100%;
    height:100%;
    border:none;
}
.play-area{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
}
.play-btn{
    width:180px;
    height:180px;
    border-radius:50%;
    background: radial-gradient(circle at top, #7be5ff, #009dff);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:30px;
    font-weight:bold;
    color:white;
    text-decoration:none;
    box-shadow:0 10px 20px rgba(0,0,0,0.3);
    cursor:pointer;
    transition:0.2s;
}
.play-btn:active{
    transform:scale(0.95);
}
.bottom-bar{
    height:90px;
    background:#4fc3ff;
    border-top-left-radius:25px;
    border-top-right-radius:25px;
    display:flex;
    justify-content:space-around;
    align-items:center;
    box-shadow:0 -3px 10px rgba(0,0,0,0.2);
}
.nav-item{
    text-align:center;
    font-size:12px;
    color:#1a6fa3;
}
.nav-circle{
    width:50px;
    height:50px;
    margin:0 auto 5px;
    border-radius:50%;
    background:linear-gradient(#aaf0ff,#4fc3ff);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    color:white;
}
.play-btn{
    width:180px;
    height:180px;
    border-radius:50%;
    background: radial-gradient(circle at top, #7be5ff, #009dff);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:30px;
    font-weight:bold;
    color:white;
    text-decoration:none;
    box-shadow:0 10px 20px rgba(0,0,0,0.3);
    cursor:pointer;
    transition:0.2s;
}

.btn-chat {
    position: fixed;      /* fica sempre fixo na tela */
    top: 10px;            /* dist√¢ncia do topo */
    right: 10px;          /* dist√¢ncia da borda direita */
    background: linear-gradient(#24c6ff, #009ef7);
    color: white;
    padding: 12px 20px;
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    z-index: 10000;       /* sempre acima de tudo */
    transition: transform 0.2s;
}

.btn-chat:hover {
    transform: scale(1.05);
}
/* ================= CHAT ================= */
#telaChat{
  background:#f3f3f3;
  display:flex;
  flex-direction:column;
}

#telaChat .topo{
  background:#4fc3ff;
  padding:15px 15px 25px 15px;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
}

#telaChat .voltar{
  font-size:22px;
  color:white;
  cursor:pointer;
  font-weight:bold;
}

#telaChat .logo{
  font-weight:bold;
  font-size:20px;
  color:white;
  position:absolute;
  left:50%;
  transform:translateX(-50%);
}

#telaChat .perfil{
  width:42px;
  height:42px;
  background:white;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  color:#4fc3ff;
  font-size:20px;
}

/* chat messages */
#chat-messages{
  flex:1;
  padding:15px;
  overflow-y:auto;
}

#chat-messages .message{
  max-width:70%;
  margin-bottom:10px;
  padding:10px 15px;
  border-radius:15px;
  word-wrap:break-word;
}

#chat-messages .sent{
  background:#24c6ff;
  color:#fff;
  margin-left:auto;
  text-align:right;
}

#chat-messages .received{
  background:#fff;
  color:#000;
  margin-right:auto;
}

/* input */
#telaChat .chat-input-container{
  display:flex;
  padding:10px 15px;
  gap:10px;
  background:#4fc3ff;
}

#chat-input{
  flex:1;
  padding:10px 15px;
  border-radius:50px;
  border:none;
  font-size:16px;
  background:#e0f7ff;
  color:#000;
}

#send-btn{
  padding:10px 20px;
  border:none;
  border-radius:50px;
  background: linear-gradient(#24c6ff,#009ef7);
  color:white;
  cursor:pointer;
  font-size:16px;
}
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family: Arial, sans-serif;
}

body{
    background: linear-gradient(#43c6ff, #e9f7ff);
    min-height:100vh;
}

/* TOPO */
.topo{
    display:flex;
    align-items:center;
    gap:10px;
    padding:15px;
}

.voltar{
    width:35px;
    height:35px;
    background:#a7e7ff;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    cursor:pointer;
}

.logo{
    font-weight:bold;
    color:#fff;
    font-size:20px;
}

/* T√çTULO */
.titulo{
    display:flex;
    align-items:center;
    gap:8px;
    padding:10px 20px;
    color:#fff;
    font-size:22px;
    font-weight:bold;
}

/* CARDS DAS M√ÅQUINAS */
.maquinas {
    display: flex;
    gap: 12px;
    padding: 10px 15px;
}

.card {
    flex: 1; /* todos os cards crescem igualmente para ocupar a largura */
    background: #fff1e3;
    border-radius: 20px;
    padding: 15px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.btn-status {
    width: 100%;        /* ocupa toda a largura do card */
    height: 36px;
    margin-top: 8px;
    background: #00d6ff;
    color: #fff;
    border: none;
    border-radius: 20px;
    font-weight: bold;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nome{
    font-size:18px;
    font-weight:bold;
    color:#25c6ff;
}

.preco{
    font-size:20px;
    font-weight:bold;
    margin:8px 0;
}

.btn-status{
    margin-top:8px;
    background:#00d6ff;
    color:#fff;
    border:none;
    width:100%;
    height:36px;              /* ALTURA FIXA */
    border-radius:20px;
    font-weight:bold;
    font-size:13px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display:flex;
    align-items:center;
    justify-content:center;
}


/* RANKING */
.ranking{
    margin:15px;
    background: linear-gradient(90deg,#004a9f,#00d6ff);
    color:#fff;
    border-radius:20px;
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

/* SELECIONAR JOGADAS */
.jogadas{
    margin:15px;
    background: linear-gradient(180deg,#00c6ff,#004a9f);
    color:#fff;
    border-radius:20px;
    padding:15px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:20px;
}

/* CONTROLES */
.controles{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
    padding:0 15px;
    margin-top:10px;
}

.botao{
    background:linear-gradient(#003f91,#0066ff);
    color:#9be7ff;
    border-radius:15px;
    text-align:center;
    padding:18px 0;
    font-size:22px;
    font-weight:bold;
    cursor:pointer;
    user-select:none;
}

/* BOT√ÉO INICIAR */
.btn-iniciar{
    margin:25px 15px;
    background:linear-gradient(#00d6ff,#0072ff);
    color:#fff;
    text-align:center;
    padding:18px;
    border-radius:25px;
    font-size:22px;
    font-weight:bold;
    cursor:pointer;
}

.selecionada {
    background: #bdbdbd !important;
    color: #fff !important;
}

.disponivel {
    background: #00d6ff !important;
    color: #fff !important;
}

.indisponivel {
    background: #9e9e9e !important;
    color: #ffffff !important;
    cursor: not-allowed;
}

.texto-manutencao{
    font-size:16px;       /* diminui o tamanho do texto */
    line-height:1.2;      /* deixa as linhas mais pr√≥ximas */
    text-align:center;    /* centraliza */
}
.notificacao{
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #000;                 /* FUNDO PRETO */
  color: #fff;                      /* TEXTO BRANCO */
  padding: 14px 22px;
  border-radius: 12px;

  border: 2px solid #ff2b2b;        /* BORDA VERMELHA */
  box-shadow: 
    0 0 10px #ff2b2b,
    0 0 25px rgba(255,43,43,0.6);

  font-family: Orbitron, sans-serif;
  font-size: 14px;
  font-weight: bold;
  text-align: center;

  z-index: 999999;
  opacity: 0;
  pointer-events: none;
  transition: opacity .4s, top .4s;
}

.notificacao.ativa{
  opacity: 1;
  top: 40px;
}



    @keyframes aparecer {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }
.loader {
  border: 4px solid #f3f3f3;        /* cor de fundo da bolinha */
  border-top: 4px solid #00d6ff;    /* cor do spinner */
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;

  /* centraliza dentro do container */
  margin: 40px auto; 
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.maquinas .card {
    display: none;  /* esconde todos os cards at√© o Firebase carregar */
}
/* INTRO */
#intro {
  position: fixed;
  inset: 0;
  background: white;
  z-index: 9999;

  display: flex;
  align-items: center;
  justify-content: center;
}


/* BOLINHA AZUL */
.ball {
  width: 40px;
  height: 40px;
  background: #00c3ff;
  border-radius: 50%;
  animation: jumpGrow 1.6s ease-in-out forwards;
}

/* LOGO DA INTRO */
.intro-logo {
  position: absolute;
  width: 220px;
  opacity: 0;
  animation: logoFade 0.5s ease forwards;
  animation-delay: 1.6s;
}


/* PULO BAIXO + CRESCIMENTO */
@keyframes jumpGrow {
  0% {
    transform: translateY(0) scale(1);
  }
  20% {
    transform: translateY(-12px) scale(1);
  }
  40% {
    transform: translateY(0) scale(1);
  }
  100% {
    transform: scale(50);
  }
}

/* APARECER LOGO */
@keyframes logoFade {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}


</style>
</head>
<body>
<div id="notificacoes"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
if (!firebase.apps.length) {
  firebase.initializeApp({
    apiKey: "AIzaSyApQ9KvXtv4_negpU9wHlajGeOuZ1FSKBA",
    authDomain: "plush-master.firebaseapp.com",
    projectId: "plush-master"
  });
}

const auth = firebase.auth();
const db = firebase.firestore();
</script>
<!-- INTRO -->
<div id="intro">
  <div class="ball"></div>
  <img class="intro-logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const logo  = document.querySelector(".intro-logo");
  const intro = document.getElementById("intro");
  const tela1 = document.getElementById("tela1");

  if (!logo || !intro || !tela1) return;

  // quando a anima√ß√£o da LOGO terminar
  logo.addEventListener("animationend", () => {

    // espera 2 segundos com a tela parada
    setTimeout(() => {

      // remove a intro
      intro.remove();

      // ativa a Tela 1
      tela1.classList.add("base");
      tela1.style.pointerEvents = "auto";

    }, 2000); // ‚è± 2 segundos

  }, { once: true });
  
});

</script>
<!-- TELA 1 -->
<section id="tela1" class="tela base">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <button class="btn" onclick="irPara('telacadastro/login')">Vamos come√ßar</button>
    </div>
    <footer>¬© 2025 PlushMaster</footer>
</section>

<!-- TELA 2 -->
<section id="telacadastro/login" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <h2>Entre ou cadastre-se</h2>
        <button class="btn" onclick="irPara('telaLogin')">Login</button>
        <button class="btn" onclick="irPara('telaCadastroEmail')">Cadastro</button>
    </div>
</section>

<!-- LOGIN EMAIL -->
<section id="telaLogin" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <h2>Login</h2>
        <input id="emailLogin" type="email" placeholder="email@email.com">
        <button class="btn" onclick="verificarEmail()">Continuar</button>
        <button class="btn" onclick="irPara('telacadastro/login')">Voltar</button>
    </div>
</section>

<!-- SENHA -->
<section id="telaSenha" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">
    <div class="card">
        <h2>Senha</h2>
        <p id="emailExibido"></p>
        <input id="senha" type="password" placeholder="Senha">
        <button class="btn" onclick="entrar()">Entrar</button>
        <button class="btn" onclick="irPara('telaLogin')">Voltar</button>
    </div>
</section>
<!-- TELA EMAIL -->
<section id="telaCadastroEmail" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

    <div class="card">
        <h2>Criar conta</h2>

        <input
          type="email"
          id="emailCadastro"
          placeholder="Digite seu email"
        >

        <button class="btn" onclick="irParaUsuario()">Continuar</button>

        <button class="btn" onclick="irPara('telacadastro/login')">Voltar</button>
    </div>
</section>


<!-- TELA USU√ÅRIO -->
<section id="telaCadastroUsuario" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

    <div class="card">
        <h2>Nome de usu√°rio</h2>

        <input
          type="text"
          id="usernameCadastro"
          placeholder="Crie um nome de usu√°rio"
        >

        <button class="btn" onclick="irParaSenha()">Continuar</button>

        <button class="btn" onclick="irPara('telaCadastroEmail')">Voltar</button>
    </div>
</section>


<!-- TELA SENHA -->
<section id="telaCadastroSenha" class="tela">
    <img class="logo" src="https://i.postimg.cc/pXQ9MCLx/plush-master-logo-removebg-preview.png">

    <div class="card">
        <h2>Criar senha</h2>

        <input
          type="password"
          id="senha1"
          placeholder="Digite a senha"
        >

        <input
          type="password"
          id="senha2"
          placeholder="Digite novamente"
        >

        <button class="btn" onclick="finalizarCadastro()">Criar conta</button>

        <button class="btn" onclick="irPara('telaCadastroUsuario')">Voltar</button>
    </div>
</section>





<!-- ================= HOME ================= -->
<section id="telaHome" class="tela">
    <!-- TOPO -->
    <div class="top-bar">
        <div class="btn-chat" onclick="irPara('telaChat')">üí¨</div>
        <div>PlushMaster</div>
        <div style="width:45px;"></div> <!-- espa√ßo √† direita para equilibrar -->
    </div>

    <!-- C√ÇMERA -->
    <div class="camera-box">
        <iframe src="https://delaysp01.logicahost.com.br:5443/onlinemachine/play.html?id=onlinemachine03"
        allow="autoplay; fullscreen"></iframe>
    </div>

    <!-- BOT√ÉO JOGAR -->
<div class="play-area">
    <button class="play-btn" onclick="irPara('telaSelecionar')" style="border:none; outline:none;">JOGAR</button>
</div>


  
    <!-- MENU INFERIOR -->
    <div class="bottom-bar">
        <div class="nav-item" onclick="irPara('telaHome')">
            <div class="nav-circle">üè†</div>
            Home
        </div>
        <div class="nav-item" onclick="irPara('telaCarteira')">
            <div class="nav-circle">üí∞</div>
            Carteira
        </div>
        <div class="nav-item" onclick="irPara('telaConta')">
            <div class="nav-circle">üë§</div>
            Conta
        </div>
        <div class="nav-item" onclick="irPara('telaPelucias')">
            <div class="nav-circle">üß∏</div>
            Pel√∫cias
        </div>
    </div>
</section>
<!-- TELA SELECIONAR -->
<section id="telaSelecionar" class="tela">
  <!-- TOPO -->
  <div class="topo">
    <div class="voltar" onclick="irPara('telaHome')">‚Üê</div>
    <div class="logo">PlushMaster</div>
  </div>

  <!-- T√çTULO -->
  <div class="titulo">üìã Selecionar m√°quina</div>

  <!-- LOADER -->
  <div id="loader" class="loader"></div>

  <!-- M√ÅQUINAS -->
  <div class="maquinas">
    <div class="card" id="cardPlush" onclick="clicarMaquina('plush')">
      <div class="nome">Plush Tiger</div>
      <div class="preco">R$ 2,00 a jogada</div>
      <div class="texto-manutencao" id="msgPlush">
        Iniciar agora<br>üòÄ ü•≥
      </div>
      <button class="btn-status disponivel" id="statusPlush">Dispon√≠vel</button>
    </div>

    <div class="card" id="cardToy" onclick="clicarMaquina('toy')">
      <div class="nome">Toy Mix</div>
      <div class="preco">R$ 5,00 a jogada</div>
      <div class="texto-manutencao" id="msgToy">
        Iniciar agora<br>üòÄ ü•≥
      </div>
      <button class="btn-status disponivel" id="statusToy">Dispon√≠vel</button>
    </div>
  </div>

  <!-- SELECIONAR JOGADAS -->
  <div class="jogadas">
    <div>üéÆ Selecionar jogadas</div>
    <div id="qtdJogadas">00</div>
  </div>

  <!-- CONTROLES -->
  <div class="controles">
    <div class="botao" onclick="alterarJogadas(-1)">‚ûñ</div>
    <div class="botao" onclick="alterarJogadas(1)">‚ûï</div>
    <div class="botao" onclick="setJogadas(5)">05</div>
    <div class="botao" onclick="setJogadas(10)">10</div>
    <div class="botao" onclick="setJogadas(15)">15</div>
    <div class="botao" onclick="setJogadas(20)">20</div>
  </div>

  <!-- BOT√ÉO INICIAR -->
  <div class="btn-iniciar" onclick="iniciarJogo()">Iniciar</div>

  <!-- SALDO -->
  <div id="saldoUsuario" style="text-align:center; font-size:20px; font-weight:bold; color:#004a9f; margin-bottom:30px;">
    Saldo: R$ 0,00
  </div>

  
</section>

<script>
let jogadas = 0;
let maquinaSelecionada = null;
let statusMaquinas = { plush: "disponivel", toy: "disponivel" };

function clicarMaquina(id) {
  if (statusMaquinas[id] === "indisponivel") return;

  const btnPlush = document.getElementById("statusPlush");
  const btnToy = document.getElementById("statusToy");

  if (id === "plush") {
    maquinaSelecionada = "plush";
    btnPlush.innerText = "Selecionada";
    btnPlush.classList.replace("disponivel", "selecionada");
    btnToy.innerText = "Dispon√≠vel";
    btnToy.classList.replace("selecionada", "disponivel");
  }

  if (id === "toy") {
    maquinaSelecionada = "toy";
    btnToy.innerText = "Selecionada";
    btnToy.classList.replace("disponivel", "selecionada");
    btnPlush.innerText = "Dispon√≠vel";
    btnPlush.classList.replace("selecionada", "disponivel");
  }
}

function alterarJogadas(valor) {
  jogadas += valor;
  if (jogadas < 0) jogadas = 0;
  atualizarJogadas();
}

function setJogadas(valor) {
  jogadas = valor;
  atualizarJogadas();
}

function atualizarJogadas() {
  document.getElementById("qtdJogadas").innerText = String(jogadas).padStart(2, "0");
}

function iniciarJogo() {
  if (!maquinaSelecionada) return notificar("Selecione uma m√°quina!");
  if (jogadas <= 0) return notificar("Selecione o n√∫mero de jogadas!");

  const status = statusMaquinas[maquinaSelecionada];
  if (status === "indisponivel" || status === "off") return notificar("A m√°quina selecionada n√£o est√° dispon√≠vel!");

  notificar("M√°quina iniciada! Boa sorte ü•≥");
}

function carregarStatusMaquinas() {
  db.collection("maquinas").onSnapshot((snapshot) => {
    console.log("Snapshot recebido:", snapshot.docs.map(d => d.data())); // <-- debug

    snapshot.forEach((doc) => {
      const id = doc.id;
      const status = doc.data().status;
      statusMaquinas[id] = status;

      const btn = document.getElementById(id === "plush" ? "statusPlush" : "statusToy");
      const msg = document.getElementById(id === "plush" ? "msgPlush" : "msgToy");

      if (status === "indisponivel") {
        btn.innerText = "Indispon√≠vel";
        btn.className = "btn-status indisponivel";
        msg.innerHTML = "manuten√ß√£o /<br>abastecimento<br>‚öôüß∏";
      } else {
        if (maquinaSelecionada !== id) {
          btn.innerText = "Dispon√≠vel";
          btn.className = "btn-status disponivel";
          msg.innerHTML = "Iniciar agora<br>üòÄ ü•≥";
        }
      }

      // Loader
      document.getElementById("loader").style.display = "none";
      document.querySelectorAll(".maquinas .card").forEach(card => card.style.display = "flex");
    });
  });
}

carregarStatusMaquinas();


// Saldo do usu√°rio
firebase.auth().onAuthStateChanged((user) => {
  if (!user) return irPara('tela1');

  db.collection("users").doc(user.uid).onSnapshot((doc) => {
    if (!doc.exists) return;
    const saldo = doc.data().saldo || 0;
    document.getElementById("saldoUsuario").innerText = "Saldo: R$ " + saldo.toFixed(2).replace(".", ",");
  });
});


</script>


<!-- TELA CHAT -->
<section id="telaChat" class="tela">
  <div class="topo">
    <div class="voltar" onclick="irPara('telaHome')">‚Üê</div>
    <div class="logo">PlushMaster</div>
    <div class="perfil" id="perfil">U</div>
  </div>

  <div id="chat-messages" style="flex:1; padding:15px; overflow-y:auto;"></div>

  <div class="chat-input-container" style="display:flex; padding:10px; gap:10px; background:#4fc3ff;">
    <input type="text" id="chat-input" placeholder="Digite sua mensagem..." style="flex:1; padding:10px 15px; border-radius:50px; border:none; font-size:16px; background:#e0f7ff; color:#000;">
    <button id="send-btn" style="padding:10px 20px; border:none; border-radius:50px; background: linear-gradient(#24c6ff,#009ef7); color:white; cursor:pointer; font-size:16px;">Enviar</button>
  </div>
</section>

<script>
const perfil = document.getElementById('perfil');
const chatInput = document.getElementById('chat-input');
const chatMessages = document.getElementById('chat-messages');
const sendBtn = document.getElementById('send-btn');


auth.onAuthStateChanged(async (user) => {
  if (!user) {
    // Se n√£o estiver logado, volta para a tela de login
    irPara('telaLogin');
    return;
  }

  // Mostra a inicial do perfil (username)
  const userDoc = await db.collection('users').doc(user.uid).get();
  if (userDoc.exists) {
    const username = userDoc.data().username;
    perfil.innerText = username.charAt(0).toUpperCase();
  }

  sendBtn.onclick = async () => {
    const text = chatInput.value.trim();
    if (!text) return;


  // Busca o nome do usu√°rio no Firestore
  const userDoc = await db.collection('users').doc(user.uid).get();
let nomeUsuario = 'Usu√°rio';

if (userDoc.exists && userDoc.data().username) {
  nomeUsuario = userDoc.data().username;
}

await db.collection('chat').add({
  username: nomeUsuario, // ‚úÖ campo correto
  uid: user.uid,
  message: text,
  timestamp: firebase.firestore.FieldValue.serverTimestamp()
});

chatInput.value = '';
};



  // Receber mensagens em tempo real
db.collection('chat').orderBy('timestamp')
  .onSnapshot(snapshot => {
    chatMessages.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const div = document.createElement('div');

      div.classList.add('message');
      div.classList.add(data.uid === user.uid ? 'sent' : 'received');

      const nome = data.user || 'Usu√°rio'; // üëà garante nome
      div.textContent = `${data.username}: ${data.message}`;


      chatMessages.appendChild(div);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
  });
});
</script>

<!-- L√ìGICA -->
<script>
let telaAtual=document.querySelector(".tela.base");

function irPara(id){
    const nova=document.getElementById(id);
    nova.classList.add("entrando");
    setTimeout(()=>{
        telaAtual.classList.remove("base");
        nova.classList.remove("entrando");
        nova.classList.add("base");
        telaAtual=nova;
    },400);
}

function verificarEmail(){
    const email=document.getElementById("emailLogin").value.trim();
    if(!email){notificar("Digite o email");return;}
    localStorage.setItem("emailLogin",email);
    document.getElementById("emailExibido").innerText=email;
    irPara("telaSenha");
}

function entrar(){
    const email=localStorage.getItem("emailLogin");
    const senha=document.getElementById("senha").value.trim();
    if(!senha){notificar("Digite a senha");return;}
    auth.signInWithEmailAndPassword(email,senha)
        .then(()=>irPara("telaHome"))
        .catch(()=>notificar("Erro no login"));
}



let emailCadastro = "";
let usernameCadastro = "";

function mostrarTela(id){
  document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
  document.getElementById(id).classList.add('ativa');
}

function irParaUsuario(){
  const email = document.getElementById('emailCadastro').value.trim();
  if(!email) return notificar("Digite o email");

  emailCadastro = email;
  irPara('telaCadastroUsuario');
}


async function irParaSenha(){
  const username = document.getElementById('usernameCadastro').value.trim();
  if(!username) return notificar("Digite o nome de usu√°rio");

  const snap = await db.collection("users")
    .where("username", "==", username)
    .get();

  if(!snap.empty){
    notificar("Nome de usu√°rio j√° existe");
    return;
  }

  usernameCadastro = username;
  irPara('telaCadastroSenha');
}



async function finalizarCadastro(){
  const senha1 = document.getElementById('senha1').value;
  const senha2 = document.getElementById('senha2').value;

  if(!senha1 || !senha2){
    notificar("Digite a senha duas vezes");
    return;
  }

  if(senha1 !== senha2){
    notificar("As senhas n√£o s√£o iguais");
    return;
  }

  try{
    const cred = await auth.createUserWithEmailAndPassword(emailCadastro, senha1);

    await db.collection("users").doc(cred.user.uid).set({
      email: emailCadastro,
      username: usernameCadastro,
      saldo: 0,
      pelucias: 0,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });

    notificar("Conta criada com sucesso!");
    irPara('telaHome'); // üî• entra direto

  }catch(err){
    notificar(err.message);
  }
}



function notificar(msg) {
  const container = document.getElementById("notificacoes");
  if (!container) return;

  const div = document.createElement("div");
  div.className = "notificacao"; // üî• CLASSE CERTA
  div.innerText = msg;

  container.appendChild(div);

  // for√ßa o navegador a reconhecer o elemento antes da anima√ß√£o
  requestAnimationFrame(() => {
    div.classList.add("ativa");
  });

  // remove ap√≥s 3 segundos
  setTimeout(() => {
    div.classList.remove("ativa");
    setTimeout(() => div.remove(), 400);
  }, 3000);
}
</script>









</body>
</html>